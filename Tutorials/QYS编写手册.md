
# **QYS编写手册**


QYS是青云播放器支持的一种文件格式，功能强大却又简单易学。
本文将介绍QYS文件的编写方法。


[TOC]


----------


## **音符与和弦**


QYS在音符的记法上与简号类似，相信只要熟悉简谱的人都能快速学会QYS的音符记法。


### **唱名与调名**


 - 与简谱类似，用数字`1~7`分别代表唱名。

 - 与简谱类似，用数字`0`表示休止符。

 - 与简谱类似，用`<1=xx>`声明调名，比如说`<1=B>`。

 - `<1=bD>`和`<1=Db>`的表述都是可以接受的。

 
 范例：南京地铁到站提示音：`<1=C>3125`。


### **音高操作符**


 - 音高操作符写在一个音符或和弦的右侧，用于改变其音高。

 - 音高操作符共有4个，分别为`#`，`b`，`,`以及`'`。

 - `#`将一个音升高半度，`b`将一个音降低半度。

 - `'`将一个音升高八度，`,`将一个音降低八度。

 - 音高操作符允许叠加和交换，但仅对其左侧的音生效。

 - 符号`'`、`,`可以写到调名中，表示所有音统一升高、降低八度。


  范例：一个A大调下的音阶用C大调表示为`<1=C>671#'2'3'4#'5#'6'`，它等价于`<1=C'>6,7,1#234#5#6`。

 > QYM语法中，`#`和`b`是前置的，`,`和`'`是后置的；而在QYS语法下，这四个操作符都是后置的。

 > 此外，QYM暂时不支持将`'`、`,`写到调名中的用法。


### **和弦记法**


 - 用方括号[]表示一个和弦，方括号里面依次写入每一个音。

 - 一个音右侧的音高操作符将只改变这个音的音高。

 - 方括号右侧的音高操作符将改变每一个音的音高。


  范例：一个bD大调下的和弦`<1=bD>[4,6,1]`，它等价于`<1=bD>[461'],`或者`<1=bD,>[461']`。
 
> QYM中的和弦用&操作符来表示，如上面的例子在QYM中应写成`<1=bD>4,&6,&1`。


### **快速地表示前一个音**


QYS提供了符号%，用来快速地表示前一个音。具体用法如下：


 - `%`表示前一个音的音高，无论前一个音是单音还是和弦。

 - `%`只复制音高，不复制时值。

 - `%`不复制打击乐，休止符和修饰音。

 - `%`后面可以继续使用音高操作符，改变`%`整体的音高


  范例：《Numb》的副歌部分第一句：`<1=F>[61'#6']%%[52'5'][61'6']%%%[747'][53'5']`（未标注时值）。

 
> QYM暂不支持这种用法。


### **时值操作符**


 - 时值操作符用于标记一个音的时值，位于音高操作符的右侧。

 - 时值操作符共有4个，分别是`-`，`_`，`.`，`` `。

 - `-`将时值增加一拍，`_`将时值减半。

 - 连续n个`.`的作用是将时值变为原来的(2-2^(-n))倍。

 - 时值操作符从左到右依次运算。

 - 当没有时值操作符时，默认为一拍。


  范例：`0-..`占3.5拍，而`1.-_`占1.25拍（虽然我们并不推荐这种写法）。


### **简单的实例**


下面展示了《彩虹》的副歌部分。


    <1=C>
    0_5_4'_3'_|2'_1'_%_%_7_1'_2'_3'_|5-

    0_5_1'_7_|6_5_5_4_3_2_3_4_|5-

    0_5_5_5_|6.6_5#_6_7_3_|1'-

    0_1'_7_1'_|2'.%_%_1'_3'_4'_|2'-

    0_5_4#_5_|3'.%_4'_3'_2'_7_|1'-

    0_1'_7_1'_|5'.%_4'_3'_2'_3'_|3'-

    2'_5_4#_5_|3'.%_4'_3'_2'_7_|1'_2'_3'_7'_

    6'.3'_|5'_4'_3'_4'_3'2'|1'-


----------


## **高级操作符**


在许多歌谱中使用了另外一些记号。而QYS也提供了对应的处理方案。本章将依次介绍这些符号的用法。
注意：若无特殊声明，本章内的`X`，`Y`均指一个音，`ABC`指若干个音，`n`指一个正整数。


### **连音线**


 - 连音线用`X^Y`表示。当`^`连接两个完全相同的音时，表示延长前一个音的时值。在这种情况下，我们推荐使用`^%`的组合，这能让阅读者一目了然。

 - 多个音之间的连音，应当在相邻每两个音之间都添加连音线。
 - 有关`^`的更多用法，参见[倚音][1]章节。


  范例：之前的实例`1.-_`中，更符合乐谱规范的表示方法是`1__^%`。


 > QYM播放器中，每一个音默认只播放原时值的7/8，因此`^`被用于强调播放一个音为满时值。而QYS播放器中，每一个音默认按照满时值播放，所以只保留了延长前一个音的功能。事实上，`1^2`和`12`在QYS下的播放效果是完全相同的，但在QYM下前者听起来更加连贯。


### **多连音**


 - n连音用`(n~)ABC`表示，其功能为将之后的n个音符的时值变为原时值的(2^Floor[Log2[n]])/n倍。

 - 举个例子，`(3~)4_4#_4_`共计1拍，`(5~)3'7415,`共计4拍。


  范例：《东方之珠》主歌第一句：`5,_6,_11-(3~)3_2_1_5,--`。
 

> QYM中多连音的语法是`(n-)ABC`。


### **滑音**


 - 滑音用`X~Y`表示，其功能为将X到Y之间的所有音平均划分，将这些音以一拍的1/6位时值从X播放到Y，使得总时值为Y的时值。

 - 滑音的时值完全等于Y的时值，与X的时值无关。
 - 滑音的第一个音一定是X，但最后一个音有可能不是Y。但无论最后一个音是不是Y，下次调用操作符`%`都将返回Y的音高。


  范例：《九月のパンプキン》主旋律最后一节：`3'_4'_3'_1'#_[62']5~7,b`。


### **顿音**

 - 顿音用音符后的`` `表示，其功能为将时值缩短为其原时值的(r-1)/r，剩下的1/r时值将自动用休止符补齐。

 - 上述参数r可以通过函数`<Stac:n>`声明，缺省值为4。
 

> 此功能暂未实装。因此先不给出实例。


### **震音**


 - 单震音用`(n-)X`表示，其功能为以一拍的2^(-n)为时值播放X，持续X的时值。

 - 双震音用`X(n=)Y`表示，其功能为以一拍的2^(-n)为时值，交替播放X和Y，持续Y的时值。

 - 双震音的时值完全等于Y的时值，与X的时值无关。

 - 使用双震音时，应确保时值能够平分给X和Y，否则会出现由于多放了一个Y而导致的时值稍长的情况。


  范例1：《ラストリモート》片段：`
7.1'#_(1-)2'-|(1-)1'#-(1-)2'-`。

  范例2：《Gate of Steiner》片段：`3(4=)3'---`
 

> QYM中暂不支持单震音。


### **倚音**


 - 倚音用`(ABC^)X`表示，其功能为快速播放A,B,C,...后紧跟X。当ABC中不超过4个音时，每个音将播放1/16拍；否则这些音将平分1/4拍。这些音播放所占用的时值将从X的时值中扣除。

 - 和弦倚音用`[ABC^X]`表示，其功能为快速播放A,[AB],[ABC],...后紧跟[ABCX]。时值的计算方法同上。

 - 倚音支持ABC中包含和弦的情况，但和弦倚音不支持ABC中包含和弦。

 - 和弦倚音右侧出现音高操作符时，将同和弦的用法一致，改变内部所有音的音高。


  范例1：《寂しい夜》主歌最后一小节：`3_4#_(7,34#^)5#-(4#5#7^)3'`。

  范例2：《宇宙を飛ぶ不思議な巫女》伴奏最后两小节：`[1#35#^1'#]--^|%--`


 > QYM中暂不支持和弦倚音。


### **简单的实例**


下面展示了《ネクロファンタジア》的片段。


    <1=D>

    [41']%_%_[61']4'__5'__6'__1''__|[27]%_[572']_75'__6'__7'_

    1''__6'__3'__1'__7__1'__7__5__6__7,__3__7,__[24#6]|1'_7_4#'__5'__(3~)6'__4'__2'__7__4#__3__7,__6,__5,__4,_

    [46]%_%_4__6__1'__4'__6'__4'__1'__6__|[57]%_%_7__2'__5'_7__2'__5'_

    [35#7]5#'__2'__6'__2'__7'__2'__6'__2'__5#'__2'__0_|[573'].%.%^|%-4#,,,~1#-

    <1=C>

    [61'3'][131']'[137]'[72']_[573']_^|%-..[61'3']_^

    %[362']'[361']'[367]'_[361']'_^|%[37]'[136]'[135]'_[146]'_^

    %[15]'[13]'[135]'_[72'6']_^|%[72'5'][72'3'][72'5']_[573']_^

    %[572'][573'][575']_[573']_^|%_[73'](3=)5--[61'3']_^

    %[361']'[137]'[72']_[573']_^|%-..[61'3']_^

    %[362']'[361']'[367]'_[361']'_^|%[137]'[136]'[135]'_[146]'_^

    %[15]'[13]'[135]'_[72'6']_^|%[72'5'][72'3'][72'3'5']_[61#'3'6']_^

    %_3'-..(3=)1#'-..|3'-.(3=)1#'-.0



----------


## **音轨操作**


### 小节号与换行符


### 实音轨与空音轨


### 子音轨


### 反复与反复跳跃


### 添加注释


----------


## **变量与函数**


### 变量与作用域


### 基本变量的声明


### 乐器的声明与使用


### 时值缩放函数


### 渐弱与渐强函数


### 其他函数



  [1]: #%E5%80%9A%E9%9F%B3